{"ast":null,"code":"// Simple API client with token support and CRA proxy to http://localhost:4000\nconst API_BASE = ''; // CRA proxy handles /api/* to backend\n\nlet token = null;\nexport const setToken = t => {\n  token = t;\n  if (t) localStorage.setItem('gs_token', t);else localStorage.removeItem('gs_token');\n};\nexport const getToken = () => token || localStorage.getItem('gs_token');\nasync function apiFetch(path, options = {}) {\n  const headers = {\n    'Content-Type': 'application/json',\n    ...(options.headers || {})\n  };\n  const t = getToken();\n  if (t) headers['Authorization'] = `Bearer ${t}`;\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...options,\n    headers\n  });\n  if (!res.ok) {\n    if (res.status === 401) {\n      // Clear session on unauthorized so user can login again\n      try {\n        localStorage.removeItem('gs_user');\n      } catch {}\n      setToken(null);\n      throw new Error('Session expired or invalid. Please login again.');\n    }\n    let msg = `HTTP ${res.status}`;\n    try {\n      const data = await res.json();\n      msg = data.message || JSON.stringify(data);\n    } catch (_) {}\n    throw new Error(msg);\n  }\n  // Try to parse json, fallback to null\n  try {\n    return await res.json();\n  } catch {\n    return null;\n  }\n}\n\n// Auth\nexport const authRegister = payload => apiFetch('/api/auth/register', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const authLogin = payload => apiFetch('/api/auth/login', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const authMe = () => apiFetch('/api/auth/me');\n\n// Admin Users\nexport const usersList = () => apiFetch('/api/users');\nexport const usersUpdateRole = (id, role) => apiFetch(`/api/users/${id}/role`, {\n  method: 'PATCH',\n  body: JSON.stringify({\n    role\n  })\n});\n\n// Registrations\nexport const registrationsCreate = payload => apiFetch('/api/registrations', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const registrationsMine = () => apiFetch('/api/registrations/me');\n\n// Bookings\nexport const bookingsCreate = payload => apiFetch('/api/bookings', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const bookingsMine = () => apiFetch('/api/bookings/me');\n\n// Tools\nexport const toolsCreate = payload => apiFetch('/api/tools', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const toolsMine = () => apiFetch('/api/tools/me');\n\n// Feedback\nexport const feedbackCreate = payload => apiFetch('/api/feedback', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const feedbackMine = () => apiFetch('/api/feedback/me');","map":{"version":3,"names":["API_BASE","token","setToken","t","localStorage","setItem","removeItem","getToken","getItem","apiFetch","path","options","headers","res","fetch","ok","status","Error","msg","data","json","message","JSON","stringify","_","authRegister","payload","method","body","authLogin","authMe","usersList","usersUpdateRole","id","role","registrationsCreate","registrationsMine","bookingsCreate","bookingsMine","toolsCreate","toolsMine","feedbackCreate","feedbackMine"],"sources":["D:/full stacks/Garden/garden-scheduler/src/services/api.js"],"sourcesContent":["// Simple API client with token support and CRA proxy to http://localhost:4000\nconst API_BASE = ''; // CRA proxy handles /api/* to backend\n\nlet token = null;\n\nexport const setToken = (t) => {\n  token = t;\n  if (t) localStorage.setItem('gs_token', t);\n  else localStorage.removeItem('gs_token');\n};\n\nexport const getToken = () => token || localStorage.getItem('gs_token');\n\nasync function apiFetch(path, options = {}) {\n  const headers = { 'Content-Type': 'application/json', ...(options.headers || {}) };\n  const t = getToken();\n  if (t) headers['Authorization'] = `Bearer ${t}`;\n  const res = await fetch(`${API_BASE}${path}`, { ...options, headers });\n  if (!res.ok) {\n    if (res.status === 401) {\n      // Clear session on unauthorized so user can login again\n      try { localStorage.removeItem('gs_user'); } catch {}\n      setToken(null);\n      throw new Error('Session expired or invalid. Please login again.');\n    }\n    let msg = `HTTP ${res.status}`;\n    try {\n      const data = await res.json();\n      msg = data.message || JSON.stringify(data);\n    } catch (_) {}\n    throw new Error(msg);\n  }\n  // Try to parse json, fallback to null\n  try { return await res.json(); } catch { return null; }\n}\n\n// Auth\nexport const authRegister = (payload) => apiFetch('/api/auth/register', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\n\nexport const authLogin = (payload) => apiFetch('/api/auth/login', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\n\nexport const authMe = () => apiFetch('/api/auth/me');\n\n// Admin Users\nexport const usersList = () => apiFetch('/api/users');\nexport const usersUpdateRole = (id, role) => apiFetch(`/api/users/${id}/role`, {\n  method: 'PATCH',\n  body: JSON.stringify({ role }),\n});\n\n// Registrations\nexport const registrationsCreate = (payload) => apiFetch('/api/registrations', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const registrationsMine = () => apiFetch('/api/registrations/me');\n\n// Bookings\nexport const bookingsCreate = (payload) => apiFetch('/api/bookings', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const bookingsMine = () => apiFetch('/api/bookings/me');\n\n// Tools\nexport const toolsCreate = (payload) => apiFetch('/api/tools', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const toolsMine = () => apiFetch('/api/tools/me');\n\n// Feedback\nexport const feedbackCreate = (payload) => apiFetch('/api/feedback', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const feedbackMine = () => apiFetch('/api/feedback/me');\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}