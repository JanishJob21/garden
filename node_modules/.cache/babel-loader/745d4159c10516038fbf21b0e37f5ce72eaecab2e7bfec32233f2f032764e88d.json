{"ast":null,"code":"// Simple API client with token support and CRA proxy to http://localhost:4000\nconst API_BASE = ''; // CRA proxy handles /api/* to backend\n\nlet token = null;\nexport const setToken = t => {\n  token = t;\n  if (t) localStorage.setItem('gs_token', t);else localStorage.removeItem('gs_token');\n};\nexport const getToken = () => token || localStorage.getItem('gs_token');\nasync function apiFetch(path, options = {}) {\n  const headers = {\n    'Content-Type': 'application/json',\n    ...(options.headers || {})\n  };\n  const t = getToken();\n  if (t) headers['Authorization'] = `Bearer ${t}`;\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...options,\n    headers\n  });\n  if (!res.ok) {\n    if (res.status === 401) {\n      // For auth endpoints, show the real error (e.g., invalid credentials) and don't clear token blindly\n      if (String(path).startsWith('/api/auth')) {\n        try {\n          const data = await res.json();\n          throw new Error(data.message || 'Invalid credentials');\n        } catch (_) {\n          throw new Error('Invalid credentials');\n        }\n      }\n      // For other endpoints, clear session and prompt re-login\n      try {\n        localStorage.removeItem('gs_user');\n      } catch {}\n      setToken(null);\n      throw new Error('Session expired or invalid. Please login again.');\n    }\n    let msg = `HTTP ${res.status}`;\n    try {\n      const data = await res.json();\n      msg = data.message || JSON.stringify(data);\n    } catch (_) {}\n    throw new Error(msg);\n  }\n  // Try to parse json, fallback to null\n  try {\n    return await res.json();\n  } catch {\n    return null;\n  }\n}\n\n// Auth\nexport const authRegister = payload => apiFetch('/api/auth/register', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const authLogin = payload => apiFetch('/api/auth/login', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const authMe = () => apiFetch('/api/auth/me');\n\n// Admin Users\nexport const usersList = () => apiFetch('/api/users');\nexport const usersUpdateRole = (id, role) => apiFetch(`/api/users/${id}/role`, {\n  method: 'PATCH',\n  body: JSON.stringify({\n    role\n  })\n});\n\n// Registrations\nexport const registrationsCreate = payload => apiFetch('/api/registrations', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const registrationsMine = () => apiFetch('/api/registrations/me');\nexport const registrationsList = () => apiFetch('/api/registrations');\n\n// Bookings\nexport const bookingsCreate = payload => apiFetch('/api/bookings', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const bookingsMine = () => apiFetch('/api/bookings/me');\nexport const bookingsList = () => apiFetch('/api/bookings');\n\n// Tools\nexport const toolsCreate = payload => apiFetch('/api/tools', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const toolsMine = () => apiFetch('/api/tools/me');\nexport const toolsList = () => apiFetch('/api/tools');\n\n// Feedback\nexport const feedbackCreate = payload => apiFetch('/api/feedback', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\nexport const feedbackMine = () => apiFetch('/api/feedback/me');\nexport const feedbackList = () => apiFetch('/api/feedback');","map":{"version":3,"names":["API_BASE","token","setToken","t","localStorage","setItem","removeItem","getToken","getItem","apiFetch","path","options","headers","res","fetch","ok","status","String","startsWith","data","json","Error","message","_","msg","JSON","stringify","authRegister","payload","method","body","authLogin","authMe","usersList","usersUpdateRole","id","role","registrationsCreate","registrationsMine","registrationsList","bookingsCreate","bookingsMine","bookingsList","toolsCreate","toolsMine","toolsList","feedbackCreate","feedbackMine","feedbackList"],"sources":["D:/full stacks/Garden/garden-scheduler/src/services/api.js"],"sourcesContent":["// Simple API client with token support and CRA proxy to http://localhost:4000\nconst API_BASE = ''; // CRA proxy handles /api/* to backend\n\nlet token = null;\n\nexport const setToken = (t) => {\n  token = t;\n  if (t) localStorage.setItem('gs_token', t);\n  else localStorage.removeItem('gs_token');\n};\n\nexport const getToken = () => token || localStorage.getItem('gs_token');\n\nasync function apiFetch(path, options = {}) {\n  const headers = { 'Content-Type': 'application/json', ...(options.headers || {}) };\n  const t = getToken();\n  if (t) headers['Authorization'] = `Bearer ${t}`;\n  const res = await fetch(`${API_BASE}${path}`, { ...options, headers });\n  if (!res.ok) {\n    if (res.status === 401) {\n      // For auth endpoints, show the real error (e.g., invalid credentials) and don't clear token blindly\n      if (String(path).startsWith('/api/auth')) {\n        try {\n          const data = await res.json();\n          throw new Error(data.message || 'Invalid credentials');\n        } catch (_) {\n          throw new Error('Invalid credentials');\n        }\n      }\n      // For other endpoints, clear session and prompt re-login\n      try { localStorage.removeItem('gs_user'); } catch {}\n      setToken(null);\n      throw new Error('Session expired or invalid. Please login again.');\n    }\n    let msg = `HTTP ${res.status}`;\n    try {\n      const data = await res.json();\n      msg = data.message || JSON.stringify(data);\n    } catch (_) {}\n    throw new Error(msg);\n  }\n  // Try to parse json, fallback to null\n  try { return await res.json(); } catch { return null; }\n}\n\n// Auth\nexport const authRegister = (payload) => apiFetch('/api/auth/register', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\n\nexport const authLogin = (payload) => apiFetch('/api/auth/login', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\n\nexport const authMe = () => apiFetch('/api/auth/me');\n\n// Admin Users\nexport const usersList = () => apiFetch('/api/users');\nexport const usersUpdateRole = (id, role) => apiFetch(`/api/users/${id}/role`, {\n  method: 'PATCH',\n  body: JSON.stringify({ role }),\n});\n\n// Registrations\nexport const registrationsCreate = (payload) => apiFetch('/api/registrations', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const registrationsMine = () => apiFetch('/api/registrations/me');\nexport const registrationsList = () => apiFetch('/api/registrations');\n\n// Bookings\nexport const bookingsCreate = (payload) => apiFetch('/api/bookings', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const bookingsMine = () => apiFetch('/api/bookings/me');\nexport const bookingsList = () => apiFetch('/api/bookings');\n\n// Tools\nexport const toolsCreate = (payload) => apiFetch('/api/tools', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const toolsMine = () => apiFetch('/api/tools/me');\nexport const toolsList = () => apiFetch('/api/tools');\n\n// Feedback\nexport const feedbackCreate = (payload) => apiFetch('/api/feedback', {\n  method: 'POST',\n  body: JSON.stringify(payload),\n});\nexport const feedbackMine = () => apiFetch('/api/feedback/me');\nexport const feedbackList = () => apiFetch('/api/feedback');\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}